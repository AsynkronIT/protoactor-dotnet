<!-- 
  This file is automatically imported by NuGet into a user's project
  when it targets a single framework, or in classic (pre 2017) csproj projects.
-->
<Project TreatAsLocalProperty="TaskFolder;TaskAssembly">
  <PropertyGroup>
    <TaskFolder Condition=" '$(MSBuildRuntimeType)' == 'Core' ">netstandard2.1</TaskFolder>
    <TaskFolder Condition=" '$(MSBuildRuntimeType)' != 'Core' ">net5.0</TaskFolder>
    <TaskAssembly>$(MSBuildThisFileDirectory)..\tasks\$(TaskFolder)\ProtoGrainGenerator.dll</TaskAssembly>
  </PropertyGroup>

  <ItemGroup>
    <!--This one is needed for files to be included on Linux  -->
    <Compile Include="$(IntermediateOutputPath)protopotato\**\*.cs" />
  </ItemGroup>

  <UsingTask TaskName="MSBuildTasks.ProtoGenTask" AssemblyFile="$(TaskAssembly)" />
  
  <ItemDefinitionGroup>
    <ProtoGen/>
  </ItemDefinitionGroup>
  
  <ItemGroup>
    <ProtoGen Include="$(MSBuildThisFileDirectory)..\tasks\$(TaskFolder)\ProtoGrainGenerator.dll" />
  </ItemGroup>

  <Target Name="ProtoGenerate" BeforeTargets="PrepareForBuild">
    <ProtoGenTask 
            IntermediateOutputPath="$(IntermediateOutputPath)"
            MSBuildProjectFullPath="$(MSBuildProjectFullPath)"
    />
  </Target>
</Project>
